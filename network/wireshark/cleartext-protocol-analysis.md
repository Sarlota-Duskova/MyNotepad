# Cleartext Protocol Analysis

### FTP Analysis

| **Notes**                                                                                                                                                                                                                                                                                                                                    | **Wireshark Filter**                                                                                                                                                                                                                                           |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Global search                                                                                                                                                                                                                                                                                                                                | <ul><li><code>ftp</code></li></ul>                                                                                                                                                                                                                             |
| <p><strong>"FTP"</strong> options for grabbing the low-hanging fruits:</p><ul><li><strong>x1x series:</strong> Information request responses.</li><li><strong>x2x series:</strong> Connection messages.</li><li><strong>x3x series:</strong> Authentication messages.</li></ul><p><strong>Note:</strong> "200" means command successful.</p> | **---**                                                                                                                                                                                                                                                        |
| <p>"x1x" series options for grabbing the low-hanging fruits:</p><ul><li><strong>211:</strong> System status.</li><li><strong>212:</strong> Directory status.</li><li><strong>213:</strong> File status</li></ul>                                                                                                                             | <ul><li><code>ftp.response.code == 211</code> </li></ul>                                                                                                                                                                                                       |
| <p>"x2x" series options for grabbing the low-hanging fruits:</p><ul><li><strong>220:</strong> Service ready.</li><li><strong>227:</strong> Entering passive mode.</li><li><strong>228:</strong> Long passive mode.</li><li><strong>229:</strong> Extended passive mode.</li></ul>                                                            | <ul><li><code>ftp.response.code == 227</code></li></ul>                                                                                                                                                                                                        |
| <p>"x3x" series options for grabbing the low-hanging fruits:</p><ul><li><strong>230:</strong> User login.</li><li><strong>231:</strong> User logout.</li><li><strong>331:</strong> Valid username.</li><li><strong>430:</strong> Invalid username or password</li><li><strong>530:</strong> No login, invalid password.</li></ul>            | <ul><li><code>ftp.response.code == 230</code></li></ul>                                                                                                                                                                                                        |
| <p>"FTP" commands for grabbing the low-hanging fruits:</p><ul><li><strong>USER:</strong> Username.</li><li><strong>PASS:</strong> Password.</li><li><strong>CWD:</strong> Current work directory.</li><li><strong>LIST:</strong> List.</li></ul>                                                                                             | <ul><li><code>ftp.request.command == "USER"</code></li></ul><ul><li><code>ftp.request.command == "PASS"</code></li></ul><ul><li><code>ftp.request.arg == "password"</code></li></ul>                                                                           |
| <p>Advanced usages examples for grabbing low-hanging fruits:</p><ul><li><strong>Bruteforce signal:</strong> List failed login attempts.</li><li><strong>Bruteforce signal:</strong> List target username.</li><li><strong>Password spray signal:</strong> List targets for a static password.<br></li></ul>                                  | <ul><li><code>ftp.response.code == 530</code></li></ul><ul><li><code>(ftp.response.code == 530) and (ftp.response.arg contains "username")</code></li></ul><ul><li><code>(ftp.request.command == "PASS" ) and (ftp.request.arg == "password")</code></li></ul> |

### HTTP Analysis

| **Notes**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | **Wireshark Filter**                                                                                                                                                                                                                                                                                                                             |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| <p>Global search</p><p><strong>Note:</strong> HTTP2 is a revision of the HTTP protocol for better performance and security. It supports binary data transfer and request&#x26;response multiplexing.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | <ul><li><code>http</code></li></ul><ul><li><code>http2</code></li></ul>                                                                                                                                                                                                                                                                          |
| <p>"HTTP <strong>Request Methods"</strong> for grabbing the low-hanging fruits:</p><ul><li>GET</li><li>POST</li><li>Request: Listing all requests</li></ul><p><br></p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <ul><li><code>http.request.method == "GET"</code></li></ul><ul><li><code>http.request.method == "POST"</code></li></ul><ul><li><code>http.request</code></li></ul>                                                                                                                                                                               |
| <p>"HTTP Response Status Codes" for grabbing the low-hanging fruits:</p><ul><li><strong>200 OK:</strong> Request successful.</li><li><strong>301 Moved Permanently:</strong> Resource is moved to a new URL/path (permanently).</li><li><strong>302 Moved Temporarily:</strong> Resource is moved to a new URL/path (temporarily).</li><li><strong>400 Bad Request:</strong> Server didn't understand the request.</li><li><strong>401 Unauthorised:</strong> URL needs authorisation (login, etc.).</li><li><strong>403 Forbidden:</strong> No access to the requested URL. </li><li><strong>404 Not Found:</strong> Server can't find the requested URL.</li><li><strong>405 Method Not Allowed:</strong> Used method is not suitable or blocked.</li><li><strong>408 Request Timeout:</strong>  Request look longer than server wait time.</li><li><strong>500 Internal Server Error:</strong> Request not completed, unexpected error.</li><li><strong>503 Service Unavailable:</strong> Request not completed server or service is down.</li></ul> | <ul><li><code>http.response.code == 200</code></li></ul><ul><li><code>http.response.code == 401</code></li></ul><ul><li><code>http.response.code == 403</code></li></ul><ul><li><code>http.response.code == 404</code></li></ul><ul><li><code>http.response.code == 405</code></li></ul><ul><li><code>http.response.code == 503</code></li></ul> |
| <p>"HTTP Parameters" for grabbing the low-hanging fruits:</p><ul><li><strong>User agent:</strong> Browser and operating system identification to a web server application.</li><li><strong>Request URI:</strong> Points the requested resource from the server.<br></li><li><strong>Full *URI:</strong> Complete URI information.</li></ul><p><strong>*URI:</strong> Uniform Resource Identifier.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <ul><li><code>http.user_agent contains "nmap"</code></li></ul><ul><li><code>http.request.uri contains "admin"</code></li></ul><ul><li><code>http.request.full_uri contains "admin"</code></li></ul>                                                                                                                                              |
| <p>"HTTP Parameters" for grabbing the low-hanging fruits:</p><ul><li><strong>Server:</strong> Server service name.<br></li><li><strong>Host:</strong> Hostname of the server</li><li><strong>Connection:</strong> Connection status.<br></li><li><strong>Line-based text data:</strong> Cleartext data provided by the server.</li><li><strong>HTML Form URL Encoded:</strong> Web form information.</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <ul><li><code>http.server contains "apache"</code></li></ul><ul><li><code>http.host contains "keyword"</code></li></ul><ul><li><code>http.host == "keyword"</code></li></ul><ul><li><code>http.connection == "Keep-Alive"</code></li></ul><ul><li><code>data-text-lines contains "keyword"</code></li></ul>                                      |

### User Agent Analysis

| **Notes**                                                                                                                                                                                                                                                                                                                                                                                                                                                    | **Wireshark Filter**                                                                                                                                                                |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Global search.                                                                                                                                                                                                                                                                                                                                                                                                                                               | <ul><li><code>http.user_agent</code></li></ul>                                                                                                                                      |
| <p>Research outcomes for grabbing the low-hanging fruits:</p><ul><li>Different user agent information from the same host in a short time notice.</li><li>Non-standard and custom user agent info.</li><li>Subtle spelling differences. <strong>("Mozilla" is not the same as  "Mozlilla" or "Mozlila")</strong></li><li>Audit tools info like Nmap, Nikto, Wfuzz and sqlmap in the user agent field.</li><li>Payload data in the user agent field.</li></ul> | <ul><li><code>(http.user_agent contains "sqlmap") or (http.user_agent contains "Nmap") or (http.user_agent contains "Wfuzz") or (http.user_agent contains "Nikto")</code></li></ul> |

### Log4j Analysis

| **Notes**                                                                                                                                                                                                                                              | **Wireshark Filters**                                                                                                                                                                                                                                                                                                            |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><strong>Research outcomes</strong> for grabbing the low-hanging fruits:</p><ul><li>The attack starts with a "POST" request</li><li>There are known cleartext patterns: "<strong>jndi:ldap</strong>" and "<strong>Exploit.class</strong>".</li></ul> | <ul><li><code>http.request.method == "POST"</code></li></ul><ul><li><code>(ip contains "jndi") or ( ip contains "Exploit")</code></li></ul><ul><li><code>(frame contains "jndi") or ( frame contains "Exploit")</code></li></ul><ul><li><code>(http.user_agent contains "$") or (http.user_agent contains "==")</code></li></ul> |

###
