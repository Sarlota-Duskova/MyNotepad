# Phishing

The syntax for email messages is known as the Internet Message Format (IMF).

**Different types of malicious emails can be classified as one of the following:**

* **Spam** - unsolicited junk emails sent out in bulk to a large number of recipients. The more malicious variant of Spam is known as MalSpam.
* **Phishing** - emails sent to a target(s) purporting to be from a trusted entity to lure individuals into providing sensitive information.
* **Spear phishing** - takes phishing a step further by targeting a specific individual(s) or organization seeking sensitive information.
* **Whaling** - is similar to spear phishing, but it's targeted specifically to C-Level high-position individuals (CEO, CFO, etc.), and the objective is the same.
* **Smishing** - takes phishing to mobile devices by targeting mobile users with specially crafted text messages.
* **Vishing** - is similar to smishing, but instead of using text messages for the social engineering attack, the attacks are based on voice calls.
* **Hyperlinks and IP addresses should be 'defanged'.**

**BEC (Business Email Compromise)**

* Is when an adversary gains control of an internal employee's account and then uses the compromised email account to convince other internal employees to perform unauthorized or fraudulent actions.

#### Sender Policy Framework (SPF)

* Is used to authenticate the sender of an email.
* With an SPF record in place, Internet Service Providers can verify that a mail server is authorized to send email for a specific domain.
* An SPF record is a DNS TXT record containing a list of the IP addresses that are allowed to send email on behalf of your domain.

`v=spf1 ip4:127.0.0.1 include:_spf.google.com -all`

* `v=spf1` -> This is the start of the SPF record
* `ip4:127.0.0.`1 -> This specifies which IP (in this case version IP4 & not IP6) can send mail
* `include:_spf.google.com` -> This specifies which domain can send mail
* `-all` -> non-authorized emails will be rejected

#### DKIM DomainKeys Identified Mail

* Is used for the authentication of an email that’s being sent.
* Like SPF, DKIM is an open standard for email authentication that is used for DMARC alignment.
* A DKIM record exists in the DNS, but it is a bit more complicated than SPF.
* DKIM’s advantage is that it can survive forwarding, which makes it superior to SPF and a foundation for securing your email.

```
v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxTQIC7vZAHHZ7WVv/5x/qH1RAgMQI+y6Xtsn73rWOgeBQjHKbmIEIlgrebyWWFCXjmzIP0NYJrGehenmPWK5bF/TRDstbM8uVQCUWpoRAHzuhIxPSYW6k/w2+HdCECF2gnGmmw1cT6nHjfCyKGsM0On0HDvxP8I5YQIIlzNigP32n1hVnQP+UuInj0wLIdOBIWkHdnFewzGK2+qjF2wmEjx+vqHDnxdUTay5DfTGaqgA9AKjgXNjLEbKlEWvy0tj7UzQRHd24a5+2x/R4Pc7PF/y6OxAwYBZnEPO0sJwio4uqL9CYZcvaHGCLOIMwQmNTPMKGC9nt3PSjujfHUBX3wIDAQAB
```

* `v=DKIM1`-> This is the version of the DKIM record. This is optional.
* `k=rsa` -> This is the key type. The default value is RSA. RSA is an encryption algorithm (cryptosystem).
* `p=` -> This is the public key that will be matched to the private key, which was created during the DKIM setup process.

#### DMARC (Domain-based Message Authentication Reporting, & Conformance)

* An open source standard, uses a concept called alignment to tie the result of two other open source standards.
* SPF (a published list of servers that are authorized to send email on behalf of a domain) and DKIM (a tamper-evident domain seal associated with a piece of email), to the content of an email.
* If not already deployed, putting a DMARC record into place for your domain will give you feedback that will allow you to troubleshoot your SPF and DKIM configurations if needed.

`v=DMARC1; p=quarantine; rua=mailto:postmaster@website.com`

* `v=DMARC1` -> Must be in all caps, and it's not optional
* `p=quarantine` -> If a check fails, then an email will be sent to the spam folder (DMARC Policy)
* `rua=mailto:postmaster@website.com` -> Aggregate reports will be sent to this email address

#### S/MIME (Secure/Multipurpose internet Mail Extensions)

* Is a widely accepted protocol for sending digitally signed and encrypted messages, the 2 main ingredients:
  1. Digital Signatures
  2. Encryption
* If Bob wishes to use S/MIME, then he'll need a digital certificate. This digital certificate will contain his public key.
* With this digital certificate, Bob can "sign" the email message with his private key.
* Mary can then decrypt Bob's message with Bob's public key.
* Mary will do the same (send her certificate to Bob) when she replies to his email, and Bob complete the same process on his end.
* Both will now have each other's certificates for future correspondence.

#### MITRE ATT\&CK

* Adversaries may communicate using application layer protocols associated with electronic mail delivery to avoid detection/network filtering by blending in with existing traffic.
* Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server.

## Phishing playbook

https://www.incidentresponse.org/workflows/download/Phishing.pdf
